# Telegram-бот по блок-схеме (Go)

Этот бот реализует сценарий из блок-схемы: приветствие → вопросы о цели покупки и бюджете → проверка на семейную ипотеку → быстрый тест → финальный выбор канала связи.

## Требования

- Go 1.20+
- Токен Telegram бота (`@BotFather`)

## Переменные окружения

- `TELEGRAM_BOT_TOKEN` — токен Telegram-бота
- `ADMIN_CHAT_IDS` — список chat_id админов через запятую (например: `111111111,222222222`)
- `MACROCRM_DOMAIN` — домен, зарегистрированный в MacroCRM (для подписи запроса)
- `MACROCRM_APP_SECRET` — секрет приложения (App_secret) для генерации `token`
- `MACROCRM_BASE_URL` — (опционально) базовый URL API, по умолчанию `https://api.macro.sbercrm.com`

Пример (macOS/Linux):

```bash
export TELEGRAM_BOT_TOKEN=123456:ABC...
export ADMIN_CHAT_IDS=111111111,222222222
export MACROCRM_DOMAIN=example.ru
export MACROCRM_APP_SECRET=your_app_secret
# export MACROCRM_BASE_URL=https://api.macro.sbercrm.com
```

## Установка и запуск

```bash
# В корне проекта
go mod tidy

# Сборка
mkdir -p bin
go build -o bin/bot ./cmd/bot

# Запуск
TELEGRAM_BOT_TOKEN=123456:ABC... ADMIN_CHAT_IDS=111111111,222222222 ./bin/bot
```

По умолчанию бот стартует в режиме long polling и поднимает healthcheck на `:8080`.

## Локальная проверка

- Откройте чат с вашим ботом в Telegram и отправьте команду `/start`.
- Следуйте кнопкам-клавиатуре.
- Для рассылки: отправьте из админского чата `/admin`, нажмите «Создать рассылку»,
  затем либо введите текст и подтвердите «Отправить», либо пришлите фото с подписью и подтвердите «Отправить».

## Основные состояния сценария

- Старт и приветствие с кнопкой «Начать»
- Цель покупки: «Для инвестиций», «Для жизни», «Для близкого»
- Бюджет: «6-10 млн», «10-15 млн», «15-20 млн»
- Вопрос о семейной ипотеке: «Да», «Нет», «Не знаю»
- Короткий тест: вопрос про ребёнка до 6 лет или ребёнка с инвалидностью до 18
- Если подходите — выбор: «В WhatsApp» или «Связаться с экспертом»

## Развитие

- Добавьте сбор контактов (номер телефона/ссылка на WhatsApp)
- Добавьте сохранение ответов в БД/CRM
- Переведите на вебхуки (ngrok/Reverse proxy) при необходимости
